# 全概率公式、贝叶斯公式与马尔科夫链

这三个概念均属于概率论与数理统计的核心内容，**全概率公式**和**贝叶斯公式**是处理**多条件下概率计算**的基础工具，聚焦于**静态概率空间**的因果推理；**马尔科夫链**是**随机过程**的经典模型，聚焦于**动态时序下**的状态转移规律，且其状态转移的计算会大量用到前两个公式，三者关联紧密。

## 一、全概率公式：由“因”推“果”，总概率的分解

### 1. 核心思想

如果一个随机事件的发生，能被**一组互斥且完备的条件（原因）** 所划分，那么该事件的总概率，等于**每个条件发生的概率**乘以**在该条件下事件发生的条件概率**的和。简单说：把复杂的总概率，拆成多个简单条件概率的加权和。

### 2. 数学表达

设样本空间 $\Omega$ 被**互斥且完备**的事件组 $A_1,A_2,\dots,A_n$ 划分（即 $A_i\cap A_j=\emptyset(i\neq j)$ ，且 $\bigcup_{i=1}^n A_i=\Omega$ ，称该事件组为**样本空间的一个划分**），对于任意事件 $B\subset\Omega$ ，有：

 $P(B)=\sum_{i=1}^n P(A_i)P(B|A_i)$ 

其中： $P(A_i)$ 是“原因 $A_i$ ”发生的先验概率， $P(B|A_i)$ 是“原因 $A_i$ 成立时，结果 $B$ ”发生的条件概率。

### 3. 关键前提

事件组 $A_1,A_2,\dots,A_n$ 必须满足**互斥性**（两两不交）和**完备性**（覆盖整个样本空间），这是全概率公式的使用基础。

### 4. 简单例子

从装有2个白球3个红球的盒子A，和3个白球1个红球的盒子B中，先随机选一个盒子（选A、B的概率各0.5），再从选中的盒子中摸一个球，求摸到白球的概率。

- 划分事件： $A_1=$ “选盒子A”， $A_2=$ “选盒子B”（互斥且完备， $P(A_1)=P(A_2)=0.5$ ）

- 目标事件： $B=$ “摸到白球”， $P(B|A_1)=2/5$ ， $P(B|A_2)=3/4$ 

- 由全概率公式： $P(B)=0.5\times\frac{2}{5} + 0.5\times\frac{3}{4} = 0.1 + 0.375 = 0.475$ 

## 二、贝叶斯公式：由“果”推“因”，后验概率的推理

### 1. 核心思想

在已知**结果事件B发生**的前提下，反推**各个原因** $A_i$  发生的概率（称为**后验概率**）。本质是对全概率公式的逆用，结合**条件概率的定义**推导而来，核心是“根据结果倒推原因的可能性”。

### 2. 数学表达

基于全概率公式的样本空间划分 $A_1,A_2,\dots,A_n$ ，对于任意事件 $B$ （ $P(B)>0$ ），有：

 $P(A_k|B)=\frac{P(A_k)P(B|A_k)}{\sum_{i=1}^n P(A_i)P(B|A_i)}$ 

其中：

- 分子 $P(A_k)P(B|A_k)$ ：联合概率 $P(A_kB)$ ，即“原因 $A_k$ 发生且结果 $B$ 发生”的概率；

- 分母：全概率公式的结果 $P(B)$ ，即“结果 $B$ 发生”的总概率；

-  $P(A_k)$ ：原因 $A_k$ 的**先验概率**（未知结果时的初始概率）；

-  $P(A_k|B)$ ：原因 $A_k$ 的**后验概率**（已知结果B后，修正后的概率）。

### 3. 简单例子（接全概率公式例子）

已知摸到了白球，求该白球来自盒子A的概率。

- 由贝叶斯公式： $P(A_1|B)=\frac{P(A_1)P(B|A_1)}{P(B)} = \frac{0.5\times\frac{2}{5}}{0.475} = \frac{0.2}{0.475} \approx 0.421$ 

### 4. 核心价值

贝叶斯公式是**概率推理**的核心，广泛应用于机器学习（贝叶斯分类）、医学诊断（已知症状推病因）、风险评估（已知结果推风险因素）等领域，核心是“根据新的证据，不断修正对事件发生概率的判断”。

## 三、马尔科夫链：动态时序的状态转移，无后效性的随机过程

### 1. 核心定义

马尔科夫链（Markov Chain，MC）是**离散时间的随机过程**，记为 ${X_n, n=0,1,2,\dots}$ ，其中 $X_n$ 表示第 $n$ 步的**状态**，所有可能的状态构成**状态空间** $S$ （有限或可列）。其核心特征是**马尔科夫性（无后效性）**：

 $P(X_{n+1}=j | X_n=i, X_{n-1}=i_{n-1},\dots,X_0=i_0) = P(X_{n+1}=j | X_n=i)$ 

简单说：**未来的状态只由现在的状态决定，与过去的状态无关**。

### 2. 关键要素

#### （1）状态转移概率

记 $p_{ij}=P(X_{n+1}=j | X_n=i)$ 为**一步转移概率**，表示从状态 $i$ 经过1步转移到状态 $j$ 的概率，满足：

- 非负性： $p_{ij}\geq0$ ；

- 归一性： $\sum_{j\in S} p_{ij}=1$ （从状态 $i$ 出发，一步必须转移到某个状态）。

#### （2）一步转移概率矩阵

若状态空间 $S$ 为有限集 ${1,2,\dots,N}$ ，则一步转移概率可构成**N阶方阵** $\boldsymbol{P}$ ：

 $\boldsymbol{P} = \begin{pmatrix}
p_{11} & p_{12} & \dots & p_{1N} \\
p_{21} & p_{22} & \dots & p_{2N} \\
\vdots & \vdots & \ddots & \vdots \\
p_{N1} & p_{N2} & \dots & p_{NN}
\end{pmatrix}$ 

矩阵的行对应**当前状态**，列对应**下一状态**，每行元素和为1。

#### （3）初始分布

记 $\pi_0(i)=P(X_0=i)$ 为**初始状态分布**，表示第0步（初始时刻）处于状态 $i$ 的概率，满足 $\sum_{i\in S} \pi_0(i)=1$ ，可表示为行向量 $\boldsymbol{\pi}_0 = (\pi_0(1),\pi_0(2),\dots,\pi_0(N))$ 。

#### （4）n步转移概率

记 $p_{ij}^{(n)}=P(X_{n}=j | X_0=i)$ 为**n步转移概率**，表示从状态 $i$ 经过 $n$ 步转移到状态 $j$ 的概率，其对应的矩阵 $\boldsymbol{P}^{(n)}$ 满足**切普曼-科尔莫戈罗夫方程**：

 $\boldsymbol{P}^{(n)} = \boldsymbol{P}^n$ 

即n步转移概率矩阵是一步转移概率矩阵的 $n$ 次幂，这是马尔科夫链状态转移计算的核心公式。

### 3. 核心计算：结合全概率公式

马尔科夫链的**n步状态分布**（第n步处于各状态的概率）计算，本质是全概率公式的迭代应用。

设第 $n$ 步的状态分布为行向量 $\boldsymbol{\pi}_n = (\pi_n(1),\pi_n(2),\dots,\pi_n(N))$ ，其中 $\pi_n(i)=P(X_n=i)$ ，则：

 $\pi_n(j) = P(X_n=j) = \sum_{i\in S} P(X_{n-1}=i)P(X_n=j | X_{n-1}=i) = \sum_{i\in S} \pi_{n-1}(i)p_{ij}$ 

用矩阵表示为：

 $\boldsymbol{\pi}_n = \boldsymbol{\pi}_{n-1} \cdot \boldsymbol{P}$ 

迭代可得： $\boldsymbol{\pi}_n = \boldsymbol{\pi}_0 \cdot \boldsymbol{P}^n$ ，即**第n步分布 = 初始分布 × n步转移概率矩阵**。

### 4. 常见分类（有限状态马尔科夫链）

根据状态转移的长期特征，马尔科夫链可分为：

#### （1）常返链与暂留链

- **常返态**：从状态 $i$ 出发，最终能回到 $i$ 的概率为1；若所有状态都是常返态，称为常返链；

- **暂留态**：从状态 $i$ 出发，最终回到 $i$ 的概率小于1（会永远离开该状态）；若存在暂留态，称为暂留链。

#### （2）遍历链

满足**不可约**（任意两个状态可互相到达）、**非周期**（状态的返回周期为1）的**有限常返链**称为遍历链。其核心性质：**无论初始分布如何，当n→∞时，n步状态分布会收敛到唯一的**平稳分布 $\boldsymbol{\pi}$ **，且** $\boldsymbol{\pi} \cdot \boldsymbol{P} = \boldsymbol{\pi}$ （平稳分布满足：转移后分布不变）。

### 5. 简单例子

一个两状态马尔科夫链，状态空间 $S={0,1}$ ，一步转移概率矩阵：

 $\boldsymbol{P} = \begin{pmatrix}
0.8 & 0.2 \\
0.3 & 0.7
\end{pmatrix}$ 

初始分布 $\boldsymbol{\pi}_0 = (0.5, 0.5)$ ，求第1步、第2步的状态分布。

- 第1步： $\boldsymbol{\pi}_1 = \boldsymbol{\pi}_0 \cdot \boldsymbol{P} = (0.5×0.8+0.5×0.3, 0.5×0.2+0.5×0.7) = (0.55, 0.45)$ 

- 第2步： $\boldsymbol{\pi}_2 = \boldsymbol{\pi}_1 \cdot \boldsymbol{P} = (0.55×0.8+0.45×0.3, 0.55×0.2+0.45×0.7) = (0.575, 0.425)$ 

该链是**遍历链**，长期会收敛到平稳分布 $\boldsymbol{\pi}=(0.6, 0.4)$ （满足 $\boldsymbol{\pi} \cdot \boldsymbol{P} = \boldsymbol{\pi}$ ）。

## 四、三者的核心关联

1. **贝叶斯公式是全概率公式的逆用**：全概率公式是“因→果”的总概率计算，贝叶斯公式是“果→因”的后验概率推理，二者均基于**条件概率**和**样本空间划分**，是静态概率计算的互补工具；

2. **马尔科夫链的状态分布计算依赖全概率公式**：第n步的状态概率，是通过全概率公式将“前一步各状态的概率”与“一步转移概率”加权求和得到，是全概率公式在**动态时序**中的迭代应用；

3. **马尔科夫链的后验推理可结合贝叶斯公式**：在实际应用中（如隐马尔科夫模型HMM），若状态不可直接观测（隐状态），只能观测到结果，此时会用贝叶斯公式，结合观测结果反推隐状态的后验概率，即“已知观测结果，推马尔科夫链的当前状态”。

## 五、典型应用场景

|公式/模型|核心应用领域|
|---|---|
|全概率公式|风险计算、彩票概率、产品合格率计算、多条件下的结果概率预估|
|贝叶斯公式|贝叶斯分类（朴素贝叶斯）、医学诊断、故障排查、自然语言处理、机器学习的概率推理|
|马尔科夫链|时间序列分析、股价预测、天气预测、文本生成（马尔科夫链文本）、排队论、隐马尔科夫模型（HMM，语音识别/词性标注）|
我可以帮你整理**三者的核心公式速记表**，并搭配1道综合应用题（融合全概率、贝叶斯和马尔科夫链的计算），需要吗？
> （注：文档部分内容可能由 AI 生成）